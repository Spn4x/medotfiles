# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# Hyprland Configuration - Eye Candy Edition    #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

# See https://wiki.hyprland.org/Configuring/Monitors/
source = ~/.config/hypr/monitors.conf

# --- ADDED: Define Special Workspace for Waybar Toggle ---
source = ~/.config/hypr/workspaces.conf

# +++ WALLUST INTEGRATION: Source generated colors +++
# This file is created by ~/.config/hypr/scripts/wallpaper.sh and contains
# variable definitions (like $wallust_background) and the actual border color settings.
source = ~/.config/hypr/colors-hyprland-generated.conf

# --------------------------------------------- #
# Execute programs on launch
# --------------------------------------------- #

# All startup processes are handled by a single script for better control and organization.
exec-once = ~/.config/hypr/scripts/startup.sh
exec-once = /usr/lib/xdg-desktop-portal-gtk


env = XDG_SESSION_TYPE=wayland
env = QT_QPA_PLATFORM=wayland
env = SDL_VIDEODRIVER=wayland
env = GDK_BACKEND=wayland
env = QT_QPA_PLATFORMTHEME,qt6ct
# env = GTK_THEME,Adwaita-dark



# --- End WALLUST INTEGRATION ---


# --------------------------------------------- #
# Input settings
# --------------------------------------------- #
input {
    kb_layout = us 
    kb_variant =
    kb_model =
    kb_options =
    kb_rules =

    follow_mouse = 1    # Focus follows mouse

    touchpad {
        natural_scroll = yes
        disable_while_typing = true
    }

    sensitivity = -0.6 # -1.0 to 1.0, 0 means no modification. Adjust mouse sensitivity if needed.
}

device {
    name = synaptics-tm3381-011
    sensitivity = 0
}



# --------------------------------------------- #
# General settings
# --------------------------------------------- #
general {
    gaps_in = 3             # Gaps between windows
    gaps_out = 6          # Gaps between windows and monitor edge
    border_size = 2
    # --- WALLUST INTEGRATION: Border colors ---
    # OLD Hardcoded border colors:
    # col.active_border = rgba(cba6f7ff) rgba(89b4faff) 45deg # Mauve -> Blue
    # col.inactive_border = rgba(45475aff) # Catppuccin Macchiato Surface0
    # NEW: These are now defined in ~/.config/hypr/colors-hyprland-generated.conf (sourced above)
    # --- End WALLUST INTEGRATION ---

    layout = dwindle        # Tiling layout (dwindle or master)
    allow_tearing = false

}


# --------------------------------------------- #
# Decoration
# --------------------------------------------- #
decoration {
    rounding = 6          # Window corner radius

    blur {
        enabled = false

        size = 1
        passes = 5
  
        ignore_opacity = false
        new_optimizations = true
    
        contrast = 1
        brightness = 1.2
        vibrancy = 0.20
        xray = false
        
    }

      # Shadow configuration - Attempting to mimic defaults
shadow {
    enabled = no
    range = 1
    render_power = 1
    ignore_window = yes
}

}

render {
       new_render_scheduling = true
}

# Hyprcursor configuration
env = XCURSOR_THEME,phinger-cursors-dark
env = XCURSOR_SIZE,24

# Environment variables for wider application compatibility
# env = XCURSOR_THEME,phinger-cursors-dark  # <-- YOUR CHOSEN THEME (Duplicate of above)
# env = XCURSOR_SIZE,24                   # (Duplicate of above)

env = QT_QPA_PLATFORM,wayland      # Prefer Wayland backend for Qt apps
env = QT_QPA_PLATFORMTHEME,qt6ct # This might conflict with Kvantum if both are set for platformtheme.
                                   # Typically, you choose one main Qt theming engine. Kvantum often handles this.

env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# --------------------------------------------- #
# Animations
# --------------------------------------------- #
animations {
    enabled = yes

    # Keep the bezier definitions
    bezier = linear, 0.0, 0.0, 1.0, 1.0
    bezier = easeOutExpo, 0.16, 1, 0.3, 1
    bezier = easeInOutCirc, 0.85, 0, 0.15, 1

    # --- ADJUSTED SPEED ANIMATIONS ---
    animation = windowsIn, 1, 2, easeOutExpo, popin 80%
    animation = windowsOut, 1, 2, easeInOutCirc, popin 80%
    animation = border, 1, 1, easeInOutCirc
    animation = borderangle, 10, 10, easeInOutCirc, loop
    animation = fade, 1, 1, easeInOutCirc
    animation = workspaces, 1, 1, easeOutExpo, slidevert

    bezier = wind, 0.05, 0.9, 0.1, 1.05
    bezier = winIn, 0.1, 1.1, 0.1, 1.1

    animation = windows,     1, 6, wind,      slide bottom
    animation = windowsIn,   1, 6, winIn,     slide bottom
    animation = windowsOut,  1, 5, winIn,     slide bottom
   
   bezier = slidey, 0, 1, 0, 1

  animation = layers, 1, 3, slidey, slide top
    
}

# --------------------------------------------- #
# Tiling Layout Specifics
# --------------------------------------------- #
dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 0
    smart_resizing = true
    }

master {
    # Default settings are usually fine
}

plugin {
    hyprexpo {
        columns = 4
        gap_size = 5
        bg_col = rgb(111111)
        workspace_method = center current
        enable_gesture = true
        gesture_fingers = 3
        gesture_distance = 300
        gesture_positive = true
        skip_empty = true

    }

 
 
   
}


# --------------------------------------------- #
# Layer Rules (For Waybar, Wofi, etc.)
# --------------------------------------------- #
layerrule = blur, waybar
layerrule = blur, namespace:wofi # Added for Wofi, check if 'wofi' is the correct namespace
layerrule = ignorezero, class:^(waybar)$
layerrule = blur, GtkLayerShell 
layerrule = blur, gtk4-layer-shell
# General blur for layer-shell windows (might catch Eww)
# Or be more specific if you know the Eww window's identifier (check hyprctl clients)
# layerrule = blur, address:0x........ # Use the actual address of the eww window when open
layerrule = noanim, selection
# layerrule = noanim, gtk4-layer-shell




# --------------------------------------------- #
# Gestures (for touchpads)
# --------------------------------------------- #
gestures {
# not valid anymore
}

# --------------------------------------------- #
# Miscellaneous Settings
# --------------------------------------------- #
misc {
    force_default_wallpaper = 0 # IMPORTANT: Keep 0 for swww to work
    disable_hyprland_logo = true
    disable_splash_rendering = true
    mouse_move_enables_dpms = true
    vfr = true
    enable_swallow = true
}

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# Keybindings
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
$mainMod = SUPER # Sets the Super/Windows key as the main modifier

# In your ~/.config/hypr/hyprland.conf
bind = $mainMod, P, exec, hyprctl dispatch togglepseudotile
bind = , F11, exec, aurora-shell --toggle calendar
bind = , F12, exec, ~/scripts/toggle-schedule.sh

# --- Applications ---
bind = $mainMod, RETURN, exec, kitty
# --- WALLUST INTEGRATION: Wofi Theming ---
# OLD Wofi drun:
# bind = $mainMod, D, exec, wofi --show drun
# NEW: Wofi drun using Wallust generated style
# bind = $mainMod, D, exec, wofi --show drun --style ~/.config/wofi/style-wallust-generated.css --allow-images --insensitive

bind = $mainMod, D, exec, aurora-shell --toggle launcher
layerrule = blur, vicinae
layerrule = ignorealpha 0.2, vicinae
layerrule = ignorezero, vicinae

# --- End WALLUST INTEGRATION ---
bind = $mainMod, B, exec, brave --enable-features=UseOzonePlatform,WebUIDarkMode --ozone-platform=wayland --no-first-run --disable-background-networking --no-default-browser-check --force-dark-mode --gtk

bind = $mainMod, O, exec, obsidian --enable-features=UseOzonePlatform,WaylandWindowDecorations --ozone-platform=wayland --ozone-platform-hint=auto --no-sandbox


bind =, F9, exec, aurora-shell --toggle control-center
bind =, F10, exec, aurora-shell --toggle mpris-player
#bind = $mainMod, TAB, overview:toggle



# Switch workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# For touchpad gestures
# Moves to the next workspace on the right
bind = , swipe:3:r, workspace, e+1

# Moves to the next workspace on the left
bind = , swipe:3:l, workspace, e-1


# --- Window Management ---
bind = $mainMod, Q, killactive,
bind = $mainMod, F, fullscreen, 0
bind = $mainMod SHIFT, F, fullscreen, 1
bind = $mainMod, P, pseudo,
bind = $mainMod, J, togglesplit,

# --- Move Focus (Vim Style) ---
bind = $mainMod, h, movefocus, l
bind = $mainMod, l, movefocus, r
bind = $mainMod, k, movefocus, u
bind = $mainMod, j, movefocus, d

# --- Move/Swap Windows (Vim Style) ---
bind = $mainMod SHIFT, h, movewindow, l
bind = $mainMod SHIFT, l, movewindow, r
bind = $mainMod SHIFT, k, movewindow, u
bind = $mainMod SHIFT, j, movewindow, d

# --- Swap Focused Window with Neighbor ---
bind = $mainMod, left, swapwindow, l
bind = $mainMod, right, swapwindow, r
bind = $mainMod, up, swapwindow, u
bind = $mainMod, down, swapwindow, d

# --- Move Focus (Arrow Keys Alternative) ---
bind = $mainMod ALT, left, movefocus, l
bind = $mainMod ALT, right, movefocus, r
bind = $mainMod ALT, up, movefocus, u
bind = $mainMod ALT, down, movefocus, d

# --- Switch Workspaces ---
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# --- Move Active Window to Workspace ---
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# --- Resize Windows ---
bind = $mainMod CTRL, H, resizeactive, -20 0
bind = $mainMod CTRL, L, resizeactive, 20 0
bind = $mainMod CTRL, K, resizeactive, 0 -20
bind = $mainMod CTRL, J, resizeactive, 0 20

# --- Floating Window Control ---
bind = $mainMod ALT, h, moveactive, -20 0
bind = $mainMod ALT, l, moveactive, 20 0
bind = $mainMod ALT, k, moveactive, 0 -20
bind = $mainMod ALT, j, moveactive, 0 20
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow



# --- Screenshot Bindings ---
bind = , Print, exec, grim ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S_screen.png')
bind = SHIFT, Print, exec, grim -g "$(slurp)" ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S_area.png')
bind = CTRL SHIFT, Print, exec, hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"' | grim -g - ~/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S_window.png')
bind = ALT, Print, exec, grim -g "$(slurp)" - | wl-copy
bind = CTRL, Print, exec, grim - | wl-copy

# --- System Controls ---
bind = $mainMod, M, exit,                       # Exit Hyprland session (logout)
bind = $mainMod SHIFT, R, exec, hyprctl reload  # <<<< HYPRLAND RELOAD BIND (Already Existed!)
# --- WALLUST INTEGRATION: Wlogout Theming ---
# OLD wlogout:
# bind = $mainMod SHIFT, E, exec, wlogout -p layer-shell
# NEW: Assuming wlogout uses wofi and can accept/pass --style.
# If not, wlogout script itself needs modification.
# bind = $mainMod SHIFT, E, exec, wlogout --style ~/.config/wofi/style-wallust-generated.css -p layer-shell
# --- End WALLUST INTEGRATION ---

# --- Eww Lockscreen Overlay Control --- (Original commented out)
#bind = , Home, exec, eww open lockscreen_overlay
#bind = , End, exec, eww close lockscreen_overlay

# Launch VS code
bind = $mainMod, v, exec, ELECTRON_OZONE_PLATFORM_HINT=auto code
# bind = $mainMod, c, exec, kitty zsh -c "source ~/.zshrc; nvim"
# bind = $mainMod, c, exec, kitty nvim
# bind = $mainMod, c, exec, emacs




# Launch Dolphin (Original was Dolphin, you changed to Nautilus)
bind = $mainMod, E, exec, nautilus

# --- Brightness Control ---
bind = ALT, F5, exec, brightnessctl set 5%-
bind = ALT, F6, exec, brightnessctl set 5%+

# --- Volume Control ---
bind =  ALT, F2, exec, pactl set-sink-volume @DEFAULT_SINK@ -5%
bind =  ALT, F3, exec, pactl set-sink-volume @DEFAULT_SINK@ +5%
bind =  ALT, F1, exec, pactl set-sink-mute @DEFAULT_SINK@ toggle

# Keybind to launch wallpaper selector (e.g., SUPER + W)
# This script now handles all theming aspects.
bind = SUPER, W, exec, aurora-shell --toggle themer

# --- Waybar Toggle ---
# bind = $mainMod, grave, togglespecialworkspace, magic # Use ` key to toggle waybar

# --- hyprspace overview Toggle --- (Original commented out)
# bind= $mainMod, A, overview:toggle

# --- WALLUST INTEGRATION: Wofi Bootmenu Theming ---
# OLD Wofi bootmenu script call:
# bind = SUPER, R, exec, ~/.local/bin/wofi-bootmenu.sh
# NEW: The SCRIPT ~/.local/bin/wofi-bootmenu.sh needs to be MODIFIED INTERNALLY
# to call wofi with '--style ~/.config/wofi/style-wallust-generated.css'.
# This binding itself remains the same, but the script it calls needs the change.
bind = SUPER, R, exec, ~/dotfiles/.config/hypr/scripts/wofi-bootmenu.sh # !!! MODIFY THIS SCRIPT INTERNALLY !!!
# --- End WALLUST INTEGRATION ---

# --- hyprlock overview Toggle --- (Original name, likely meant Hyprlock itself)
bind = SUPER, L, exec, hyprlock

# Add to your keybindings section
bind = $mainMod, S, centerwindow # Or any key combo you prefer

# Custom: Make active window small, floating, and centered
bind = $mainMod, A, exec, ~/.config/hypr/scripts/float_center_resize.sh

bind = ALT, SPACE, exec, aurora-shell --toggle topbar

bind = $mainMod, N, exec, swaync-client -t

# --- Cheatsheet Toggle ---
bind = , HOME, exec, aurora-shell --toggle cheatsheet

bind = , Caps_Lock, exec, ~/scripts/sprint.sh

layerrule = ignorealpha 0.1, waybar

layerrule = blur, swaync-control-center
layerrule = blur, swaync-notification-window
layerrule = ignorezero, swaync-control-center
layerrule = ignorezero, swaync-notification-window
layerrule = ignorealpha 0.2, swaync-control-center
layerrule = ignorealpha 0.2, swaync-notification-window

layerrule = blur, ironbar
layerrule = ignorezero, ironbar
layerrule = ignorealpha 0.2, ironbar
layerrule = blur, gtk-layer-shell
layerrule = ignorealpha 0.2, gtk-layer-shell
layerrule = blur, wofi
layerrule = ignorealpha 0.2, wofi
layerrule = ignorealpha 0.2, gtk4-layer-shell


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# Window Rules
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more

# --- Window Rules for Waybar ---
windowrulev2 = workspace special:magic, class:^(waybar)$
windowrulev2 = noanim, class:^(waybar)$



# --- General Floating Rules ---
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = float, title:^(Bluetooth Devices)$
windowrulev2 = float, class:^(org\.kde\.polkit-kde-authentication-agent-1)$ # Matches your exec-once
windowrulev2 = float, class:^(lxqt-policykit-agent)$ # Matches your exec-once
windowrulev2 = float, class:^(xdg-desktop-portal-gtk)$
windowrulev2 = float, class:^(xdg-desktop-portal-kde)$
windowrulev2 = float, class:^(qt5ct)$
windowrulev2 = float, class:^(qt6ct)$
windowrulev2 = float, class:^(nwg-look)$
windowrulev2 = float, title:^(Open File)$
windowrulev2 = float, title:^(Save File)$
windowrulev2 = float, title:^(Choose Files)$

# --- Application Specific Floating Rules ---
# Make Kitty open as a small, centered, floating window
windowrulev2 = center, class:^(kitty)$
windowrulev2 = pseudo, class:^(Kitty)$
windowrulev2 = pseudo, class:^(Emacs)$
windowrulev2 = noshadow, class:^(kitty)$

# Make Dolphin open as a medium, centered, floating window (original was Dolphin, you use Nautilus)
windowrulev2 = float, class:^(org.gnome.Nautilus)$
windowrulev2 = size 75% 75%, class:^(org.gnome.Nautilus)$
windowrulev2 = center, class:^(org.gnome.Nautilus)$

# Make VS Code (replace 'code-oss' if your class is different) launch floating
windowrulev2 = float, center, class:^(code-oss)$ # Added center
windowrulev2 = size 80% 85%, class:^(code-oss)$
windowrulev2 = pseudo, class:^(code-oss)$
windowrulev2 = float, class:^nvimfloat$
windowrule = opacity 0.92, class:^(code-oss)$

windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = center, class:^(nm-connection-editor)$

windowrulev2 = float, class:^(blueman-manager)$
windowrulev2 = center, class:^(blueman-manager)$
# windowrule = noscreenshare, class:^(brave-browser)$



windowrule = float, class:^(GLava)$


#awindowrule = opacity 0.91, class:^(brave-browser)$ (Original commented out)
windowrule = opacity 0.76, class:^(com.github.th_ch.youtube_music)$

# --- End of Configuration ---

